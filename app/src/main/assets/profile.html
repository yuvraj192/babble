<!DOCTYPE html>
<html lang="en" xmlns:text-align="https://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link href="tailwind.css" rel="stylesheet">
    <link rel="stylesheet" href="icons.css">
    <script src="jquery.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css" />
    <style>
        .fullpage{
            height: 100%;
            width:100%;
            background-color:#fff;
            padding:10px;
            padding-top:2.2% !important;
        }
        .prepage{
            height: 99%;
            width:90%;
            background-color:#dedede;
            padding-top:3% !important;
            padding:2.5% !important;
            transition:0.5s ease all;
        }
        .subpage{
            height: 97.9%;
            width:95%;
            background-color:#fff;
            padding:2.9% !important;
            transition:0.5s ease all;
        }
        .theme-shade-text{
            color: #7d4df9 !important;
        }
        .theme-shade-bg{
            background-color: #7d4df9 !important;
        }
        button:focus{ outline:none !important; }
        .pic{
            height:auto;
            max-height:215px;
            min-width:115px;
            max-width:115px;
            margin:5px;
            border-radius:10px;
        }
    </style>
</head>

<body style="background-color:#000;overflow:none !important;" class="px-3">

<div class="fixed inset-x-0 bottom-0 rounded-t-lg mx-auto fullpage">
    <header class="text-gray-700 body-font fixed inset-x-0 top-0 z-10 py-3" style="height:56px;">
        <button class="right-0 float-right theme-shade-text mr-5 mt-2" onclick="profile.close()">Done</button>
    </header>

    <section class="text-gray-700 body-font">
        <div class="container px-5 py-12 mx-auto">
            <div class="flex flex-wrap sm:-m-4 -mx-4 -mb-10 -mt-4">
                <div class="p-4 md:w-1/3 md:mb-0 mb-6 flex flex-col text-center items-center">
                    <div class="inline-flex items-center justify-center rounded-full text-indigo-500 flex-shrink-0">
                        <img alt="team"
                             class="w-32 h-32 bg-white object-cover object-center flex-shrink-0 rounded-full ml-2 dpimg"
                             src="https://contacts.zoho.com/file?ID=3031352&t=user&fs=thumb" type="image/jpeg" onclick="switcher('.profilepicture')" />
                    </div>
                    <a class="mt-3 text-indigo-500 inline-flex items-center" onclick="switcher('.profilepicture')">Edit</a>
                    <div class="flex-grow w-full mx-auto">
                        <h2 class="text-gray-900 text-lg title-font font-medium"> <span class="uname" onclick="switcher('.changeName')">  </span> </h2>
                        <p class="leading-relaxed text sm text-gray-400 bdt" onclick="//switcher('.birthday')"></p>
                        <p class="leading-relaxed text-sm opacity-0">Blue bottle crucifix vinyl post-ironic four dollar toast vegan taxidermy</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="container px-5 py-2 mx-auto -mt-16 border-t border-gray-200 pt-5 overflow-auto">
            <div class="flex flex-wrap sm:-m-4 -mx-4 -mb-10 -mt-4">
                <div class="p-4 md:w-1/3 md:mb-0 mb-2 flex" onclick="switcher('.moodnotif')">
                    <div class="w-12 h-12 inline-flex items-center justify-center rounded-full bg-indigo-100 theme-shade-text mb-4 flex-shrink-0">
                        <i class="material-icons">whatshot</i>
                    </div>
                    <div class="flex-grow pl-6">
                        <h2 class="text-gray-900 text-lg title-font font-medium">Moods</h2>
                        <a class="theme-shade-text inline-flex items-center text-sm">Customize mood settings</a>
                    </div>
                </div>
                <div class="p-4 md:w-1/3 md:mb-0 mb-6 flex">
                    <div class="w-12 h-12 inline-flex items-center justify-center rounded-full bg-indigo-100 text-indigo-500 mb-4 flex-shrink-0">
                        <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="w-6 h-6" viewBox="0 0 24 24">
                            <circle cx="6" cy="6" r="3"></circle>
                            <circle cx="6" cy="18" r="3"></circle>
                            <path d="M20 4L8.12 15.88M14.47 14.48L20 20M8.12 8.12L12 12"></path>
                        </svg>
                    </div>
                    <div class="flex-grow pl-6">
                        <h2 class="text-gray-900 text-lg title-font font-medium mb-2">The Catalyzer</h2>
                        <a class="mt-3 text-indigo-500 inline-flex items-center">Learn More
                            <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="w-4 h-4 ml-2" viewBox="0 0 24 24">
                                <path d="M5 12h14M12 5l7 7-7 7"></path>
                            </svg>
                        </a>
                    </div>
                </div>
                <div class="p-4 md:w-1/3 md:mb-0 mb-6 flex">
                    <div class="w-12 h-12 inline-flex items-center justify-center rounded-full bg-indigo-100 text-indigo-500 mb-4 flex-shrink-0">
                        <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="w-6 h-6" viewBox="0 0 24 24">
                            <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>
                    <div class="flex-grow pl-6">
                        <h2 class="text-gray-900 text-lg title-font font-medium mb-2">Neptune</h2>
                        <a class="mt-3 text-indigo-500 inline-flex items-center">Learn More
                            <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="w-4 h-4 ml-2" viewBox="0 0 24 24">
                                <path d="M5 12h14M12 5l7 7-7 7"></path>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
<div class="fixed inset-x-0 bottom-0 animate__animated animate__slideInUp animate__faster rounded-t-lg mx-auto changeName" style="display:none;">
    <button class="left-0 top-0 float-left text-red-700" onclick="deswitch()">Cancel</button>
    <div class="container px-5 py-24 mx-auto flex flex-wrap items-center">
        <div p class="lg:w-2/6 md:w-1/2 bg-blue rounded-lg p-8 flex flex-col md:ml-auto w-full mt-10 md:mt-0">
            <h2 align="center" class="text-black text-2xl font-medium title-font mb-12"><b>What's your name?</b></h2>
            <input class="bg-white rounded focus:outline-none text-base px-4 border-b py-3 mb-4 fname placeholder-gray-600" placeholder="First name" type="text">
            <input class="bg-white rounded focus:outline-none text-base px-4 border-b py-3 mb-4 lname placeholder-gray-600" placeholder="last name" type="text">
            <button onclick="changeName(this);" class="theme-shade-bg text-white  border-0 py-2 px-8 focus:outline-none rounded text-center mt-4">Save</button>
        </div>
    </div>
</div>
<div class="fixed inset-x-0 bottom-0 animate__animated animate__slideInUp animate__faster rounded-t-lg mx-auto profilepicture " style="display:none;">
    <button class="left-0 top-0 float-left text-red-700" onclick="deswitch()">Cancel</button>
    <button class="left-0 top-0 float-right text-blue-600 upload-btn" style="display:none;" onclick="this.innerHTML = 'Uploading...';uploadImage()">Done</button>
    <section class="text-gray-700 body-font">
        <div class="container px-5 py-12 mx-auto">
            <div class="flex flex-wrap sm:-m-4 -mx-4 -mb-10 -mt-4">
                <div class="p-4 md:w-1/3 md:mb-0 mb-6 flex flex-col text-center items-center">
                    <div class="inline-flex items-center justify-center rounded-full text-indigo-500 flex-shrink-0">
                        <img alt="team"
                             class="w-40 h-40 bg-white object-cover object-center flex-shrink-0 rounded-full ml-2 subdpimg"
                             src="https://contacts.zoho.com/file?ID=3031352&t=user&fs=thumb" type="image/jpeg" onclick="switcher('.profilepicture')" />
                    </div>
                    <div class="flex-grow w-full mx-auto opacity-0">
                        <h2 class="text-gray-900 text-lg title-font font-medium"></h2>
                        <p class="leading-relaxed text-sm">Blue bottle crucifix vinyl post-ironic four dollar toast vegan taxidermy</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex -mt-10 border-t border-gray-200 pt-3" style="width:100% !important;">
            <h2 class="text-gray-900 title-font font-medium float-left mr-5">Suggestions</h2>
            <p class="theme-shade-text text-sm float-right" onclick="masterswitch('.allpics');photo.Gallery()">All Photos</p>
        </div>
    </section>
</div>
<div class="fixed inset-x-0 bottom-0 animate__animated animate__slideInUp animate__faster rounded-t-lg mx-auto moodnotif" style="display:none;">
    <button class="left-0 top-0 float-left text-red-700" onclick="deswitch()">Cancel</button>
</div>
<div class="fixed inset-x-0 bottom-0 animate__animated animate__slideInUp animate__faster rounded-t-lg mx-auto birthday" style="display:none;">
    <button class="left-0 top-0 float-left text-red-700" onclick="deswitch()">Cancel</button>
    <div class="container px-5 py-24 mx-auto flex flex-wrap items-center">
        <div p class="lg:w-2/6 md:w-1/2 bg-blue rounded-lg p-8 flex flex-col md:ml-auto w-full mt-10 md:mt-0">
            <h2 align="center" class="text-black text-2xl font-medium title-font mb-12"><b>When's your birthday?</b></h2>
            <input class="bg-white rounded focus:outline-none text-base px-4 pl-24 border-b py-3 mb-4 bdate placeholder-gray-600 w-full" type="date" value="2002-09-21">
            <button onclick="deswitch()" class="theme-shade-bg text-white  border-0 py-2 px-8 focus:outline-none rounded text-center mt-4">Save </button>
        </div>
    </div>
</div>

<div class="fixed inset-x-0 bottom-0 animate__animated animate__slideInUp animate__faster rounded-t-lg mx-auto allpics" style="display:none;">
    <button class="left-0 top-0 float-left text-red-700 cancel-btn" onclick="mdeswitch('.allpics')">Cancel</button>
    <button class="left-0 top-0 float-right text-blue-700 final-btn animate__animated animate__fadeIn" style="display:none;" onclick="mdeswitch('.allpics')">Done</button>
    <br>
    <div class="picsContainer overflow-x-hidden h-full">

    </div>
</div>

</body>

<!--

-->
<script>
    var phoneNumber;

    function getDetails(){
        var xhr = new XMLHttpRequest();
        xhr.onload = function (e) {
            if (this.readyState === 4) {
                var details = JSON.parse(this.responseText)
                $('.uname').html(details.username)
                $('.bdt').html(details.bd)
            }
        };
        xhr.open("GET", "https://iotine.zapto.org:4600/acDetails/" + phoneNumber, true);
        xhr.send();
    }

    function loadDp() {
        var xhr = new XMLHttpRequest();
        xhr.onload = function (e) {
            if (this.readyState === 4) {
                $(".dpimg").attr('src', `https://iotine.zapto.org:4600/files/${this.responseText}`)
                $(".subdpimg").attr('src', `https://iotine.zapto.org:4600/files/${this.responseText}`)
            }
        };
        xhr.open("GET", "https://iotine.zapto.org:4600/dpOf/" + phoneNumber, true);
        xhr.send();
    }

    function setPno(num){
        phoneNumber = num
        getDetails()
        loadDp()
    }

    firstCall = true
    var lastRow;
    var lastRowCount = 0

    function prevImage(image, num) {
        //if(firstCall){ $('.picsContainer').html(""); firstCall = false}
        var imageTag = `<img src="${image}" class="pic">`
        if(lastRowCount == 0){
            var row = createNewRow()
            row.innerHTML += imageTag
            lastRowCount += 1
        }else if(lastRowCount >= 3){
            lastRowCount = 0
            var row = createNewRow()
            row.innerHTML += imageTag
            lastRowCount += 1
        }else{
           $(`#${lastRow}`).append(imageTag)
            lastRowCount += 1
        }
        phoneNumber = num
        addListenersToImages()
        //uploadImage(url);
    }

    function createNewRow(){
        var row = document.createElement('div')
        row.className += 'row w-full flex'
        row.id = '_' + Math.random().toString(36).substr(2, 9);
        lastRow = row.id
        $('.picsContainer').append(row)
        return row;
    }

    function addListenersToImages(){
        var allImages = document.querySelectorAll('.pic')
        allImages.forEach(item => {
            item.addEventListener('click', event => {
                $('.subdpimg').attr('src', item.src)
                $('.upload-btn').show()
                $('.final-btn').show()
                allImages.disabled = "disabled"
            })
        })
    }
    function uploadImage() {
        var img = new Image;
        var c = document.createElement("canvas");
        var ctx = c.getContext("2d");
        var filename = new Date().toISOString() + ".jpeg";

        img.onload = function () {
            c.width = this.naturalWidth; // update canvas size to match image
            c.height = this.naturalHeight;
            ctx.drawImage(this, 0, 0); // draw in image
            c.toBlob(function (blob) { // get content as JPEG blob
                var xhr = new XMLHttpRequest();
                xhr.onload = function (e) {
                    if (this.readyState === 4) {
                        deswitch()
                    }
                };
                var fd = new FormData();
                fd.append("dp_data", blob, filename);
                xhr.open("POST", "https://iotine.zapto.org:4600/newdp/" + phoneNumber, true);
                xhr.send(fd);
            }, "image/jpeg", 0.75);
        };
        img.crossOrigin = "Anonymous"; // if from different origin
        img.src = $('.subdpimg').attr('src');
    }

function changeName(elm){
      elm.classList.add('cursor-not-allowed')

      $('.uname').html($('.fname').val() + ' ' + $('.lname').val())

      setTimeout(() => {
        deswitch();
        elm.classList.remove('cursor-not-allowed')
       }, 100)
    //masterswitch(elm)
}

function switcher(elm){
    setTimeout(() => $('.fullpage').addClass('prepage').removeClass('fullpage'), 150)
    $(elm).addClass('subpage').show()
}

function deswitch(){
    $('.prepage').addClass('fullpage').removeClass('prepage')
    $('.subpage').hide().removeClass('subpage')
}

function masterswitch(elm){
    $('.prepage').removeClass('prepage').addClass('fullpage').hide()
    $('.subpage').addClass('prepage').slideDown().removeClass('subpage')
    $(elm).addClass('subpage').show()
}

function mdeswitch(elm){
    $(elm).hide().removeClass('subpage')
    $('.prepage').addClass('subpage').removeClass('prepage')
    $('.fullpage').addClass('prepage').removeClass('fullpage').show()
}

</script>

</html>